<!--
    File            : register.html
    Project         : WDD A2 Web forms
    Programmer      : Nick Byam, 8656317
    Last Change     : 2020-09-29
    Description     : This project is aimed at giving a working example of how to use web forms and input types to gather information from a user,
                    : and perform client-side validation processes before sending the form off to a server via the submit event handlers.
-->

<!DOCTYPE HTML>
<HTML>
    <head>
        <meta charset="UTF-8"/>
        <!--Title for the page appearing on the tab-->
        <title>
            SET Registration
        </title>
        <script type="text/javascript">


        //********************************************************
        // Function     : Init
        // Description  : A function to initialize the styles of some elements that shouldn't show up yet. Also set the checkboxes to disapear
        //              : when the reset form button is clicked.
        // Parameters   : N/A
        // Returns      : N/A
        //********************************************************
        function init()
        {
            document.getElementById("stdntChecks").style.display = "none";
            document.getElementById("fcltChecks").style.display = "none";
            document.getElementById("stdntRadio").checked = false;
            document.getElementById("fcltRadio").checked = false;
            document.getElementById("nameErr").innerHTML = "";
            document.getElementById("addrErr").innerHTML = "";
            document.getElementById("cityErr").innerHTML = "";
            document.getElementById("provErr").innerHTML = "";
            document.getElementById("pocoErr").innerHTML = "";
            document.getElementById("typeErr").innerHTML = "";
        }


        //********************************************************
        // Function     : typeClick
        // Description  : A function that makes it so only the check boxes for the right radio button appear, and not both at once.
        //              : when the user switches between student and faculty, any boxes that were checked will no longer be checked.
        // Parameters   : N/A
        // Returns      : N/A
        //********************************************************
        function typeClick()
        {
            var stdnt = document.getElementById("stdntRadio").checked; //store the elements in variables for easier access
            var fclt = document.getElementById("fcltRadio").checked;
            
            if (stdnt) // the checked property is a boolean, so if the student option is checked the variable will be set to true
            {
                document.getElementById("stdntChecks").style.display = "block"; // make the student check boxes appear, and the faculty boxes disappear
                document.getElementById("fcltChecks").style.display = "none";
                var temp = document.getElementsByName("fcltBoxes"); // uncheck all the boxes that appear under the other type
                for (var i = 0; i < temp.length; i++)
                {
                    temp[i].checked = false;
                }
            }
            else
            {
                document.getElementById("fcltChecks").style.display = "block"; // faculty checkboxes appear and student ones disappear
                document.getElementById("stdntChecks").style.display = "none";
                var temp = document.getElementsByName("stdntBoxes"); // when faculty is selected, uncheck all student checkboxes
                for (var i = 0; i < temp.length; i++)
                {
                    temp[i].checked = false;
                }
            }
        }

        
        //********************************************************
        // Function     : formValidate
        // Description  : This function does the legwork for the form's validation. In this function two objects are introduced, one to manage boolean flags
        //              : that signify whether an input field is valid, and another that keeps track of province dependent postal code regexes. Each field is validated
        //              : one by one, and if it passes, its corresponding flag is set to true. If all flags are true at the end, the function returns true and the
        //              : form submits, if a single flag is false, the form won't submit and will instead raise an error on the screen under the invalid field.
        // Parameters   : N/A
        // Returns      : boolean : if true the form submits, else the form does not submit, this boolean is dependent on the flags.
        //********************************************************
        function formValidate()
        {
            var element;

            var FlagObj = {
                nameFlag : false, // These are flags for each necessary input field, until every flag is true, the form will not be allowed to submit
                addrFlag : false,
                cityFlag : false,
                provFlag : false,
                pocoFlag : false,
                rdioFlag : false,
                

                //********************************************************
                // Method       : AllTrue
                // Description  : A method that tests if all the flags are true, meaning all inputs are valid.
                // Parameters   : f1, f2, f3, f4, f5, f6 : These correspond to the flags for name, address, city, province, postal code, and occupation type in that order
                // Returns      : boolean : if all flags are true, then return true, if even one is false, return false.
                //********************************************************
                AllTrue : function(f1, f2, f3, f4, f5, f6){
                    if (f1 === true && f2 === true && f3 === true && f4 === true && f5 === true && f6 === true)
                    { return true; }
                    else 
                    { return false; }
                }
            };

            var PostalObj = {
                // objects with regex literals for each province's correct starting digit and the province itself.
                NL : { regex : /^A[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "NL"},
                NS : { regex : /^B[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "NS"},
                PE : { regex : /^C[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "PE"},
                NB : { regex : /^E[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "NB"},
                QC : { regex : /^[G-J][0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "QC"},
                ON : { regex : /^[K-NP][0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "ON"},
                MB : { regex : /^R[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "MB"},
                SK : { regex : /^S[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "SK"},
                AB : { regex : /^T[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "AB"},
                BC : { regex : /^V[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "BC"},
                NU : { regex : /^X[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "NU"},
                NT : { regex : /^X[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "NT"},
                YT : { regex : /^Y[0-9][A-Z]\s[0-9][A-Z][0-9]/, prov : "YT"},

                selectedProv : "" // the province that is selected on the drop down menu is stored here later.
            }

            
            //********************************************************
            // Function     : errMessage
            // Description  : a function that displays an error message under the correct field based on the id or name passed to it.
            // Parameters   : place : a string that contains the id of the element containing invalid input
            // Returns      : N/A
            //********************************************************
            function errMessage(place)
            {
                if (place === "FnLName") // invalid at First and last name field
                {
                    document.getElementById("nameErr").innerHTML = "<b>*Invalid Name Entry*</b>";
                }
                else if (place === "stAddr") // invalid at the street address field
                {
                    document.getElementById("addrErr").innerHTML = "<b>*Invalid Address Entry*</b>";
                }
                else if (place === "cityIn") // invalid at the city name field
                {
                    document.getElementById("cityErr").innerHTML = "<b>*Invalid City Name*</b> (Capitalize first letter)";
                }
                else if (place === "provinceSelect") // invalid at the province drop down menu
                {
                    document.getElementById("provErr").innerHTML = "<b>*Please Select a Province*</b>";
                }
                else if (place === "postal") // invalid postal code entry
                {
                    document.getElementById("pocoErr").innerHTML = "<b>*Invalid Postal Code*</b>";
                }
                else if (place[0].id === "stdntRadio") // the user never clicked the student or faculty button
                {
                    document.getElementById("typeErr").innerHTML = "<b>*Please Choose an Occupation*</b>";
                }
            }


            //********************************************************
            // Function     : MakeProvArr
            // Description  : A function that makes an array of the objects within the postal object. This is repetitive and I don't like this function
            //              : however I was running into problems when I tried to do it other ways, so I resolved to just push them one by one into an array.
            //              : This is later used to loop over and find the correct regex to compare the postal code against.
            // Parameters   : N/A
            // Returns      : provinces : The resultant array containing the province objects from the PostalObj object.
            //********************************************************
            function MakeProvArr()
            {
                var provinces = [];
                provinces.push(PostalObj.NL);
                provinces.push(PostalObj.NS);
                provinces.push(PostalObj.PE);
                provinces.push(PostalObj.NB);
                provinces.push(PostalObj.QC);
                provinces.push(PostalObj.ON);
                provinces.push(PostalObj.MB);
                provinces.push(PostalObj.SK);
                provinces.push(PostalObj.AB);
                provinces.push(PostalObj.BC);
                provinces.push(PostalObj.NU);
                provinces.push(PostalObj.NT);
                provinces.push(PostalObj.YT);
                return provinces;
            }


            //********************************************************
            // Function     : FindPostalRegex
            // Description  : A function that loops over the province list and checks to see which province the user selected, and get its associated regex.
            // Parameters   : provList : The list of province objects containing the abbreviation of the province, and a regex for the province's postal codes
            //              : province : the province the user selected on the form
            // Returns      : RegEx : on the happy path the regex of the province the user selected is returned.
            //              :       : When the user does not select a province a random regex is returned that will fail, because the calling function expects
            //              :       : a regex, and null causes problems, thus returning a random regex covers the exception path.
            //********************************************************
            function FindPostalRegex(provList, province)
            {
                for (var i = 0 ; i < provList.length ; i++)
                {
                    if (province === provList[i].prov) // loop over the province objects to find an abbreviation that matches the user's selection
                    {
                        return provList[i].regex; // when the province is found, return the corresponding regex
                    }
                }
                return /\.[P][5-6]\s\s/; // the function that calls this expects a regex so I'm giving one that will fail all the time, unless the user gets really lucky
            }

            // Validate the first and last name field for only alpha characters and one space
            var nameRegex = /[a-z]+\s[a-z]+/i;
            element = document.getElementById("FnLName");
            if (nameRegex.test(element.value) === true)
            {
                FlagObj.nameFlag = true; // name is valid
            }
            else
            {
                errMessage(element.id); // name is invalid
            }
            

            // Validate address for sequence of numbers, a space then a sequence of alpha and spaces
            var addrRegex = /\d+\s[a-zA-Z\s]+/;
            element = document.getElementById("stAddr");
            if (addrRegex.test(element.value) === true)
            {
                FlagObj.addrFlag = true; // address is valid
            }
            else
            {
                errMessage(element.id); // adress is invalid
            }

            // Validate city for only alpha characters and spaces, requires the first letter to be capitalized
            var cityRegex = /^[A-Z][a-z]+\s?[A-Z]?[a-z]*/
            element = document.getElementById("cityIn");
            if(cityRegex.test(element.value) === true)
            {
                FlagObj.cityFlag = true; // city is valid
            }
            else
            {
                errMessage(element.id); // city is invalid
            }

            // validate a province has been picked, remember the abbreviation by assigning it to the PostalObj
            element = document.getElementById('provinceSelect');
            var tempProv = element.options[element.selectedIndex].value; 
            if (tempProv != 0)
            {
                FlagObj.provFlag = true;
                PostalObj.selectedProv = tempProv; // a province was selected
            }
            else
            {
                errMessage(element.id); // a province was not selected
            }

            // validate postal code is NAN ANA, make sure first number matches province
            element = document.getElementById("postal");
            var provPostRegex = FindPostalRegex(MakeProvArr(), PostalObj.selectedProv); // create the province array, then find the matching postal code regex
            if (provPostRegex.test(element.value) === true) // test the postal code against the regex
            {
                FlagObj.pocoFlag = true; // postal code valid
            }
            else
            {
                errMessage(element.id); // postal code invalid
            }

            // validate a type has been checked, either student or teacher
            element = document.getElementsByName("typeRadio");
            if (element[0].checked === true || element[1].checked === true) // if either is true, the input is valid
            {
                FlagObj.rdioFlag = true; // user picked one
            }
            else
            {
                errMessage(element); // user did not pick one
            }

            // If every entry was valid, then all flags will now be true. Test if they are all true
            var proceed = FlagObj.AllTrue(FlagObj.nameFlag, FlagObj.addrFlag, FlagObj.cityFlag, FlagObj.provFlag, FlagObj.pocoFlag, FlagObj.rdioFlag);
            return proceed; // the value of proceed determines if the form will submit
        }

        </script>
    </head>

    <body>
        <h1 align="center">
            SET Registration Form
        </h1>
        <form action="http://localhost/testRequest.asp" method="GET" name="myForm" id="myForm"> <!--Problems with submitting when return false, taking it out-->
            <script type="text/javascript">document.getElementById("myForm").onsubmit = function() { return formValidate();}</script> <!--of inline fixed it-->
            <table border="0" width="100%">
                <tr> <!--The first and last name-->
                    <td align="right" width="20%">
                        First and Last Name :
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left">
                        <input type="text" name="FnLName" id="FnLName"/> <!--Name input box-->
                        <div id="nameErr"></div>
                    </td>
                </tr>
                <tr> <!--The street address-->
                    <td align="right" width="20%">
                        Street Address :
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left">
                        <input type="text" name="stAddr" id="stAddr"/> <!--Address input box-->
                        <div id="addrErr"></div>
                    </td>
                </tr>
                <tr> <!--The City name-->
                    <td align="right" width="20%">
                        City :
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left">
                        <input type="text" name="cityIn" id="cityIn"/> <!--City input box-->
                        <div id="cityErr"></div>
                    </td>
                </tr>
                <tr> <!--The province drop down menu-->
                    <td align="right" width="20%">
                        Province :
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left">
                        <select name="province" id="provinceSelect"> <!--Province drop down menu, the value submitted to the server is the canada post abbreviation-->
                            <option value="0">&nbsp;</option>
                            <option value="NL">Newfoundland & Labrador</option>
                            <option value="NS">Nova Scotia</option>
                            <option value="PE">Prince Edward Island</option>
                            <option value="NB">New Brunswick</option>
                            <option value="QC">Quebec</option>
                            <option value="ON">Ontario</option>
                            <option value="MB">Manitoba</option>
                            <option value="SK">Saskatchewan</option>
                            <option value="AB">Alberta</option>
                            <option value="BC">British Columbia</option>
                            <option value="NT">North West Territories</option>
                            <option value="NU">Nunavut</option>
                            <option value="YT">Yukon</option>
                        </select>
                        <div id="provErr"></div>
                    </td>
                </tr>
                <tr> <!--The Postal code-->
                    <td align="right" width="20%">
                        Postal Code :
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left">
                        <input type="text" name="postal" id="postal"/> <!--Postal code input box-->
                        <div id="pocoErr"></div>
                    </td>
                </tr>
                <tr> <!--Student or faculty radio buttons, in the same group-->
                    <td align="right" width="20%">
                        Student :
                        <input type="radio" name="typeRadio" id="stdntRadio" onclick="typeClick()"/><!--Student radio button, with an event handler that shows checkboxes-->
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left" width="20%">
                        Faculty :
                        <input type="radio" name="typeRadio" id="fcltRadio" onclick="typeClick()"/><!--Faculty radio btn, with an event handler that shows check boxes-->
                        <div id="typeErr"></div>
                    </td>
                </tr>
                <tr>
                    <td align="right" width="20%">
                        <div id="stdntChecks"> <!--Check boxes for the student-->
                            <label for="study">Study in Information Technology</label>
                            <input type="checkbox" name="stdntBoxes" id="study" value="Study IT"><br/>
                            <label for="laptop">Own a Laptop Computer</label>
                            <input type="checkbox" name="stdntBoxes" id="laptop" value="Own Laptop"><br/>
                            <label for=bus>Take Bus to School</label>
                            <input type="checkbox" name="stdntBoxes" id="bus" value="Bus to School"><br/>
                            <label for="wdd">Enjoys Web Design and Development</label>
                            <input type="checkbox" name="stdntBoxes" id="wdd" value="Enjoys WDD (who wouldn't?)"><br/>
                        </div>
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left" width="20%">
                        <div id="fcltChecks"> <!--Check boxes for the faculty-->
                            <input type="checkbox" name="fcltBoxes" id="teach" value="Teach Eng">
                            <label for="">Teach in Engineering</label><br/>
                            <input type="checkbox" name="fcltBoxes" id="car" value="Drive Car">
                            <label for="">Drive Car to Work</label><br/>
                            <input type="checkbox" name="fcltBoxes" id="lunch" value="Brings Lunch">
                            <label for="">Bring Lunch</label><br/>
                        </div>
                    </td>
                </tr>
                <tr> <!--Register (submit) button and Clear Form (reset) button-->
                    <td align="right" width="20%">
                        <input type="submit" value="Register"/>
                    </td>
                    <td width="2%">&nbsp;</td>
                    <td align="left">
                        <input type="reset" value="Clear Form" onclick="init()"/> <!--Calling init on click sets radio btns unchecked, and checkboxes invisible-->
                    </td>
                </tr>
            </table>
        </form>
        <script type="text/javascript">
        init(); // init is called here at the bottom to make sure the page is set up properly right after it loads.
        </script>
    </body>
</HTML>